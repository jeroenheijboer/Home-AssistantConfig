# Pulse sensor water
  - platform: serial
    serial_port: /dev/ttyACM0
# Slimme meter DSMR
#  - platform: dsmr
#    port: /dev/ttyUSB0
# Weather prediction
  - platform: yr
# PV Output
  - platform: pvoutput
    system_id: !secret pvoutput_system_id
    api_key: !secret pvoutput_api_key
    scan_interval: 150
  - platform: template
    sensors:
#Zonnepanelen
#      power_consumption:
#        value_template: '{% if is_state_attr("sensor.pvoutput", "power_consumption", "NaN") %}0{% else %}{{ states.sensor.pvoutput.attributes.power_consumption }}{% endif %}'
#        friendly_name: 'Using'
#        unit_of_measurement: 'Watt'
#      energy_consumption:
#        value_template: '{{ "%0.1f"|format(states.sensor.pvoutput.attributes.energy_consumption|float/1000) }}'
#        friendly_name: 'Used'
#        unit_of_measurement: 'kWh'
      power_generation:
        value_template: '{% if is_state_attr("sensor.pvoutput", "power_generation", "NaN") %}0{% else %}{{ states.sensor.pvoutput.attributes.power_generation }}{% endif %}'
        friendly_name: 'Generating'
        unit_of_measurement: 'Watt'
      energy_generation:
        value_template: '{% if is_state_attr("sensor.pvoutput", "energy_generation", "NaN") %}0{% else %}{{ "%0.2f"|format(states.sensor.pvoutput.attributes.energy_generation|float/1000) }}{% endif %}'
        friendly_name: 'Generated'
        unit_of_measurement: 'kWh'
# Water sensoren
#      m1_pulse_count:
#        value_template: '{{% set strtext = states("sensor.serial_sensor") %}{% set m1_pulse_count = ( strtext.split(':')[5]) %}}'
#      m1_value: 
#        value_template: '{% set strtext = states("sensor.serial_sensor") %}{% set m1_value = ( strtext.split(':')[6] ) %}'
#      m1_liters: 
#        value_template: '{% set strtext = states("sensor.serial_sensor") %}{% set m1_liters = ( m1_value )| float/10 %}'
#      m2_pulse_count: 
#        value_template: '{% set strtext = states("sensor.serial_sensor") %}{% set m2_pulse_count =( strtext.split(':')[8] ) %}'
#      m2_value: 
#        value_template: '{% set strtext = states("sensor.serial_sensor") %}{% set m2_value = ( strtext.split(':')[9] ) %}'
#      m3_pulse_count:
#        value_template: '{% set strtext = states("sensor.serial_sensor") %}{% set m3_pulse_count = ( strtext.split(':')[11] ) %}'
#      m3_value: 
#        value_template: '{% set strtext = states("sensor.serial_sensor") %}{% set m3_value = ( strtext.split(':')[12] ) %}'
#      m4_pulse_count:
#        value_template: '{% set strtext = states("sensor.serial_sensor") %}{% set m4_pulse_count = ( strtext.split(':')[14] ) %}'
#      m4_value:
#        value_template: '{% set strtext = states("sensor.serial_sensor") %}{% set m4_value = ( strtext.split(':')[15] ) %}'
#      m5_pulse_count:
#        value_template: '{% set strtext = states("sensor.serial_sensor") %}{% set m5_pulse_count = ( strtext.split(':')[17] ) %}'
#      m5_value:
#        value_template: '{% set strtext = states("sensor.serial_sensor") %}{% set m5_value = ( strtext.split(':')[18] ) %}'
# Power Tarief hernoemen
      stroom_tarief:
        friendly_name: "Huidig tarief"
        value_template: >-
          {% if is_state('sensor.power_tariff', 'low') %}
            Laag
          {% else %}
            Normaal
          {% endif %}
# Netto Energie verbruik
      energie_netto_verbruik:
        friendly_name: Netto energie verbruik
        value_template: >
          {%  if states.sensor.power_consumption.state and states.sensor.power_generation.state != "unknown" %}
          {{ (states.sensor.power_consumption.state | float * 1000) - states.sensor.power_generation.state | float }}
          {% else %}
          "unknown"
          {% endif %}
        unit_of_measurement: 'Watt'
# Energie verbruik in Watt
      energie_stroom_verbruik:
        friendly_name: Stroom verbruik
        value_template: >
          {%  if states.sensor.power_consumption.state != "unknown" %}
          {{ states.sensor.power_consumption.state | float * 1000 }}
          {% else %}
          "unknown"
          {% endif %}
        unit_of_measurement: 'Watt'

# Roomba Thinking Cleaner
  - platform: thinkingcleaner
#Monitor Pi System
  - platform: systemmonitor
    scan_interval:
     minutes: 30
    resources:
      - type: disk_free
        arg: /
      - type: memory_free
      - type: processor_use
      - type: last_boot
  - platform: command_line
    name: ha_internal_dbsize
    scan_interval:
     minutes: 1440
    command: "du -m /home/pi/.homeassistant/home-assistant_v2.db | cut -f1"
    unit_of_measurement: 'MB'
    value_template: '{{ value | int - 1 }}'
  - platform: command_line
    name: ha_recorder_dbsize
    scan_interval:
     minutes: 1440
    command: /home/pi/.homeassistant/scripts/check_mysql_dbsize.sh
    unit_of_measurement: "MB"
  - platform: cert_expiry
    scan_interval:
     minutes: 1440
    host: homeassistant.vd-meer.com
    port: 8123
# Buienradar
  - platform: buienradar
    latitude: !secret buienradar_latitude
    longitude: !secret buienradar_longitude
    monitored_conditions:
      - stationname
      - symbol
      - humidity
      - temperature
      - groundtemperature
      - windspeed
      - windforce
      - winddirection
      - windazimuth
      - pressure
      - visibility
      - windgust
      - precipitation
      - irradiance
      # Forecast
      - precipitation_forecast_average
      - precipitation_forecast_total
      - symbol_1d
      - temperature_1d
      - rainchance_1d
      - rain_1d
  - platform: google_travel_time
    api_key: !secret google_travel_time_api_key
    origin: zone.home
    destination: zone.work
    name: Travel Time Home to Work
    options:
     arrival_time: '08:15:00'
  - platform: google_travel_time
    api_key: !secret google_travel_time_api_key
    origin: device_tracker.iphone_van_martin
    destination: zone.home
    name: Travel Time Martin to Home
